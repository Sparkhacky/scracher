{% extends "layout.html" %}
{% block content %}

<div class="flex items-center justify-between mb-6">
  <h1 class="text-xl font-black text-cyan-400 tracking-wider">ðŸ“¤ EXPORTAR</h1>
</div>

<div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">

  <div class="card p-6 text-center">
    <div class="text-3xl mb-3">{ }</div>
    <div class="font-bold text-white mb-1">JSON</div>
    <div class="text-xs text-slate-400 mb-4">Estructurado Â· wallets Â· threat intel<br>Para integraciÃ³n con otras herramientas</div>
    <button onclick="exportFmt('json')" class="btn btn-cyan w-full justify-center">Exportar JSON</button>
  </div>

  <div class="card p-6 text-center">
    <div class="text-3xl mb-3">ðŸ“Š</div>
    <div class="font-bold text-white mb-1">CSV</div>
    <div class="text-xs text-slate-400 mb-4">Tabla plana Â· compatible Excel<br>Para anÃ¡lisis en hoja de cÃ¡lculo</div>
    <button onclick="exportFmt('csv')" class="btn btn-green w-full justify-center">Exportar CSV</button>
  </div>

  <div class="card p-6 text-center">
    <div class="text-3xl mb-3">ðŸ“„</div>
    <div class="font-bold text-white mb-1">HTML</div>
    <div class="text-xs text-slate-400 mb-4">Informe forense completo<br>Para LEA / CERT / entrega</div>
    <button onclick="exportFmt('html')" class="btn btn-gray w-full justify-center">Exportar HTML</button>
  </div>

</div>

<div class="mb-4 flex items-center gap-3">
  <button onclick="exportFmt('all')" class="btn btn-cyan">â¬‡ Exportar todo (JSON + CSV + HTML)</button>
  <div id="export-status" class="text-xs text-slate-500"></div>
</div>

<div id="export-result" class="hidden card p-4 mb-6">
  <div class="text-xs text-slate-500 uppercase tracking-wider mb-3">Archivos generados</div>
  <div id="export-files" class="space-y-2"></div>
</div>

<!-- Historial de exports -->
{% if files %}
<div class="card overflow-x-auto">
  <div class="p-4 border-b border-slate-800 text-xs text-slate-500 uppercase tracking-wider">Exports anteriores</div>
  <table>
    <thead><tr><th>Archivo</th><th>TamaÃ±o</th><th></th></tr></thead>
    <tbody>
    {% for f in files %}
    <tr>
      <td class="font-mono text-sm">{{ f.name }}</td>
      <td class="text-slate-400 text-xs">{{ (f.size / 1024)|round(1) }} KB</td>
      <td><a href="/api/export/download/{{ f.name }}" class="btn btn-gray text-xs">â¬‡ Descargar</a></td>
    </tr>
    {% endfor %}
    </tbody>
  </table>
</div>
{% endif %}

<script>
function exportFmt(fmt){
  const status = document.getElementById('export-status');
  status.textContent = 'Generando...';
  status.className = 'text-xs text-cyan-400 animate-pulse';

  fetch('/api/export/'+fmt, {method:'POST'})
    .then(r=>r.json())
    .then(d=>{
      status.textContent = 'Completado';
      status.className = 'text-xs text-green-400';
      if(d.files && d.files.length){
        document.getElementById('export-result').classList.remove('hidden');
        const container = document.getElementById('export-files');
        container.innerHTML = '';
        d.files.forEach(path=>{
          const name = path.split('/').pop();
          const div = document.createElement('div');
          div.className = 'flex items-center justify-between p-2 bg-slate-800 rounded';
          div.innerHTML = `<span class="font-mono text-sm text-slate-300">${name}</span>
            <a href="/api/export/download/${name}" class="btn btn-cyan text-xs">â¬‡ Descargar</a>`;
          container.appendChild(div);
        });
      }
      setTimeout(()=>location.reload(), 2000);
    })
    .catch(()=>{
      status.textContent = 'Error';
      status.className = 'text-xs text-red-400';
    });
}
</script>
{% endblock %}
